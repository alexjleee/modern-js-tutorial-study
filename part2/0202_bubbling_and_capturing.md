# 이벤트 버블링 & 캡처링

- 버블링과 캡처링은 [이벤트 위임(event delegation)](/part2/0203_event_delegation.md)의 토대가 된다.

## 버블링 (Bubbling)

- 이벤트 버블링: 특정 화면 요소에서 이벤트가 발생했을 때, 해당 요소에서 시작해 이벤트가 DOM 트리를 따라 부모 요소를 거슬러 올라가며 전달되는 특성

- 한 요소에 이벤트가 발생하면, 그 요소의 핸들러가 동작하고 이어서 부모 요소의 핸들러가 동작한다. 이 연쇄는 가장 최상단 요소를 만날 때 까지 반복되며 요소 각각에 할당된 핸들러가 동작한다.

- _거의_ 모든 이벤트는 버블링된다. (버블링되지 않는 대표적인 이벤트: `focus`)

```html
<nav onClick="alert('nav')">
  <ul onClick="alert('ul')">
    <li onClick="alert('li)"></li>
  </ul>
</nav>
```

- 위의 예시에서, 가장 안쪽에 있는 `<li>`를 클릭하면,

  1. `<li>`에 할당된 `onClick` 핸들러가 동작

  2. `<ul>`에 할당된 `onClick` 핸들러가 동작

  3. `<nav>`에 할당된 `onClick` 핸들러가 동작

  4. 최상위의 `document` 객체를 만날 때까지 각 요소에 할당된 `onClick` 핸들러가 동작

### event.target

- `event.target`으로 이벤트가 발생한 가장 안쪽 요소에 접근할 수 있다.

  - `event.target`은 실제 이벤트가 시작된 타깃 요소로 버블링이 진행되어도 바뀌지 않는다.

  - `this`(=`event.currentTarget`)은 현재 실행 중인 핸들러가 할당된 요소를 가리킨다.

### 버블링 중단하기

- 이벤트 버블링은 타깃 요소에서 시작해 `document` 객체를 만날 때까지 모든 요소에서 발생한다. (몇몇 이벤트는 `window` 객체까지 거슬러 올라가기도 한다.)

- `event.stopPropagation()` 이벤트 객체 메서드를 사용하면 핸들러에서 이벤트 처리 후 버블링을 중단하도록 명령할 수 있다.

  - `event.stopPropagation()`은 해당 핸들러 이후의 버블링은 막아주지만 요소에 같은 이벤트를 처리하는 다른 핸들러들이 있을 경우 그 핸들러들의 동작까지는 막을 수 없다. 버블링을 멈추고 요소에 할당된 다른 핸들러들의 동작도 막으려면 `event.stopImmediatePropagation()`을 사용해야 한다.

- 주의! 꼭 필요한 경우에만 버블링을 중단한다. 추후에 버블링이 필요한 경우가 생길 수 있다.

  - 아키텍처를 고려해 버블링을 반드시 막아야 하는 상황에서만 버블링을 중단한다. (이벤트 버블링을 막아야 하는 경우는 거의 없다.)

## 캡처링 (Capturing)

- 표준 DOM 이벤트의 정의에 따른 이벤트 흐름:

  1. 캡쳐링 단계 : 이벤트가 하위 요소로 전파

  2. 타깃 단계 : 이벤트가 실제 타깃 요소에 전달 (별도로 처리되지는 않음. 캡쳐링, 버블링 단계의 핸들러는 타깃 단계에서 트리거됨)

  3. 버블링 단계 : 이벤트가 상위 요소로 전파

- `on<event>` 프로퍼티, HTML 속성, `addEventListener()`를 이용해 할당된 핸들러는 타깃 단계, 버블링 단계의 이벤트 흐름에서만 동작한다.

- 캡쳐링 단계의 이벤트를 잡아내려면 `addEventListner()`의 `capture` 옵션을 `true`로 설정해야 한다. (`addEventListener(..., true)`)

- 캡쳐링 단계는 거의 쓰이지 않고 주로 버블링 단계만 다뤄진다. (`addEventListener()`의 디폴트도 버블링 단계에서 작동하는 것이다.)

  - 버블링 단계에서 이벤트를 다루는 이유: 특정 요소에 할당된 핸들러가 그 요소의 모든 것을 알고 있기 때문에 그 요소를 다루는데 가장 적합하다. 따라서 상위 요소가 아닌 타깃이 되는 그 요소의 핸들러에 기회를 먼저 주기 위해서다.

- 현재 발생 중인 이벤트 흐름의 단계는 `event.eventPhase`로 알 수 있다. 반환값이 `1`이면 캡쳐링, `2`면 타깃, `3`이면 버블링이다.
